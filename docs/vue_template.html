<!DOCTYPE html>
<html>
<head>
  <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/@mdi/font@5.x/css/materialdesignicons.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.min.css" rel="stylesheet">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui">
</head>
<body>
  <div id="app">
    <v-app>
      <v-main>
        <v-container>
          <v-card>
            <v-toolbar
              color="blue darken-4"
              dark
              flat
            >
              <!-- <v-icon>mdi-silverware</v-icon> -->
              <v-toolbar-title>Interactive PHR Model</v-toolbar-title>
            </v-toolbar>
        
            <v-row>
              <v-col cols="4">
                <v-card-text>
                  <v-treeview
                    v-if="phases.length > 0"
                    v-model="selectedItems"
                    :items="phases"
                    open-all
                    selected-color="indigo"
                    open-on-click
                    selectable
                    return-object
                    expand-icon="mdi-chevron-down"
                    on-icon="mdi-bookmark"
                    off-icon="mdi-bookmark-outline"
                    indeterminate-icon="mdi-bookmark-minus"
                  >
                  </v-treeview>
                </v-card-text>
              </v-col>
              <!-- <v-divider vertical></v-divider> -->
              <v-col>
                <v-card-text>
                  <div
                    v-if="selectedItems.length === 0"
                    key="title"
                    class="title font-weight-light grey--text pa-4 text-center"
                  >
                    Select the content you want to display
                  </div>

                  <div v-if="selectedItems.length > 0" >
                    <v-scroll-x-transition
                      group
                      hide-on-leave
                    >
                      <v-chip
                        v-for="(selection, i) in selectedItems"
                        :key="i"
                        color="grey"
                        dark
                        small
                        class="ma-1"
                      >
                        <v-btn
                          icon
                          color="white"
                          x-small
                          class="mr-2"
                          @click="removeSelectedItem(i)"
                        >
                          <v-icon>mdi-close</v-icon>
                        </v-btn>
                        {{ selection.name }}
                      </v-chip>
                    </v-scroll-x-transition>
                  </div>
                
                  <v-card
                    v-for="(selection, i) in selectedItems"
                    :key="i"
                    class="my-6"
                  >
                    <v-card-title
                      style="border-top: 4px solid #0d47a1;"
                    >
                      {{selection.relative_path}}
                      <v-btn
                        icon
                        color="primary"
                        :href="selection.url"
                        class="ml-2"
                      >
                        <v-icon>mdi-github</v-icon>
                      </v-btn>
                      <v-spacer></v-spacer>
                      <v-btn
                        icon
                        color="error"
                        @click="removeSelectedItem(i)"
                      >
                        <v-icon>mdi-close</v-icon>
                      </v-btn>
                    </v-card-title>
                    <v-card-text>
                      <view-mk
                        :key="i"
                        :url="selection.markdown_url"
                      >
                      </view-mk>
                    </v-card-text>
                  </v-card>
                </v-card-text>
              </v-col>
            </v-row>
        
            <v-divider></v-divider>
        
            <v-card-actions>
              <v-btn
                text
                @click="selectedItems = []"
              >
                Reset
              </v-btn>
        
              <v-spacer></v-spacer>
        
              <v-btn
                class="white--text"
                color="blue darken-4"
                depressed
              >
                Export
                <v-icon right>
                  mdi-content-save
                </v-icon>
              </v-btn>
            </v-card-actions>
          </v-card>
        </v-container>
      </v-main>
    </v-app>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/vue@2.x/dist/vue.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vue-markdown@2.2.4/dist/vue-markdown.js"></script>
  <script>
    Vue.use(VueMarkdown);
    Vue.component('view-mk', {
      data(){
        return {
          markdown: ''
        }
      },
      props: ['url'],
      async mounted(){
        this.fetchData()
      },
      methods: {
        async fetchData() {
          const response = await fetch(this.url)
          this.markdown = await response.text()
        }
      },
      watch: {
        url: function(){
          this.fetchData()
        }
      },
      template: `
        <vue-markdown
          :key="url"
          class="mt-5"
          :source="markdown"
        >
        </vue-markdown>
      `
    })
    new Vue({
      el: '#app',
      vuetify: new Vuetify(),
      data: () => ({
        phases: [JSON_PLACEHOLDER],
        selectedItems: [],
        preOpenedItems: [],
        testmk: '## Header'
      }),

      async created(){
        const response = await fetch('./test2.json')
        // this.phases = [await response.json()]
        console.log([await response.json()])
      },

      methods: {
        removeSelectedItem(index){
          this.selectedItems.splice(index, 1)
        }
      }
    })
  </script>
</body>
</html>